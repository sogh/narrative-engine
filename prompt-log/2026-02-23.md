# Prompt Log — 2026-02-23

## Prompt

User reported a possessive pronoun bug: the template `{possessive}` produces the determiner form ("her", "his", "their") but certain grammatical contexts require the standalone/independent possessive form ("hers", "his", "theirs"). Example output: "The secret was no longer her alone." should be "The secret was no longer hers alone."

## Work Done

The `Pronouns` enum already had `possessive_standalone()` and `reflexive()` methods, but the grammar template system only recognized `{subject}`, `{object}`, and `{possessive}` as pronoun tokens.

### Changes

1. **`src/core/grammar.rs`** — `parse_segment()`: Added `"possessive_standalone"` and `"reflexive"` to the recognized pronoun ref tokens.
2. **`src/core/grammar.rs`** — `resolve_pronoun()`: Added match arms for `"possessive_standalone"` (calls `entity.pronouns.possessive_standalone()`) and `"reflexive"` (calls `entity.pronouns.reflexive()`). Updated the binding key mapping so both resolve against the subject entity.
3. **`src/core/grammar.rs`** — Updated doc comments on `PronounRef` variant and `Template::parse()` to document the new tokens.
4. **`tests/fixtures/test_grammar.ron`** — Added `possessive_standalone_test` and `reflexive_test` rules.
5. **`src/core/grammar.rs`** — Added 6 new tests: parse and expansion tests for both `{possessive_standalone}` and `{reflexive}`, plus pronoun variant coverage (HeHim, TheyThem).
6. **`CLAUDE.md`** — Documented the new `{possessive_standalone}` and `{reflexive}` template tokens.

### Usage

Grammar authors can now write templates like:
- `"The secret was no longer {possessive_standalone} alone."` → "The secret was no longer hers alone."
- `"{subject} reminded {reflexive} to stay calm."` → "Margaret reminded herself to stay calm."
