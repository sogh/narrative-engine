# Prompt Log — 2026-02-22

## Entry 1

**Time:** 2026-02-22
**Prompt:** "Yeah start working on the pronoun issue."

**Context:** After running `cargo run --example dinner_party`, the output showed `{possessive}` template references resolving to "Eleanor's", "Robert's" etc. instead of actual pronouns ("her", "his"). The `resolve_pronoun` function in `grammar.rs` was a placeholder that appended `'s` to entity names.

**Work — Pronoun Resolution System (COMPLETE):**
- Added `Pronouns` enum to `src/schema/entity.rs` with variants: `SheHer`, `HeHim`, `TheyThem`, `ItIts`
- Each variant provides methods: `subject()`, `object()`, `possessive()`, `possessive_standalone()`, `reflexive()`
- Added `pronouns: Pronouns` field to `Entity` struct
- Updated `resolve_pronoun()` in `src/core/grammar.rs` to return actual pronoun forms for `{possessive}`
- Updated all 14 entity construction sites across: entity.rs tests, grammar.rs tests, pipeline.rs tests, pipeline_tests.rs, dinner_party.rs (5 entities), jurassic_park.rs (7 entities), preview.rs (dynamic)
- Added `Pronouns` to public re-exports in `lib.rs`
- All 106 tests pass, no warnings
- Verified: dinner party now outputs "her voice", "his drink" instead of "Eleanor's voice", "Robert's drink"

## Entry 2

**Time:** 2026-02-22
**Prompt:** "Add dialogue to grammar templates and examples"

**Work — Dialogue Lines in Grammar Templates (COMPLETE):**

### Social Drama (`genre_data/social_drama/grammar.ron`)
- Added `dialogue_line` supporting rule with 7 alternatives — polite but pointed social drama speech fragments ("I beg your pardon?", "You cannot be serious.", etc.)
- Added 2 dialogue alternatives (weight 2) to each of 7 narrative function rules:
  - `revelation_opening`: subject speaks the reveal, "something I have been meaning to say"
  - `revelation_body`: reactive dialogue, "How long have you known?"
  - `confrontation_opening`: direct accusations, "You cannot be serious" / "That is not what I was told"
  - `confrontation_body`: back-and-forth exchange, "I beg your pardon?" / "You owe me an explanation"
  - `betrayal_opening`: "How could you?" / cracking voice with dialogue_line
  - `alliance_opening`: conspiratorial murmurs, "Perhaps we should all sit down"
  - `comic_relief_opening`: witty quips, "at least the wine is good"

### Survival Thriller (`genre_data/survival_thriller/grammar.ron`)
- Added `radio_chatter` supporting rule with 7 alternatives — terse military/emergency radio speech ("All units, fall back", "breach in sector seven", etc.)
- Added 2 dialogue alternatives (weight 2) to each of 6 narrative function rules:
  - `escalation_opening`: urgent spoken orders, "Move, move, move!"
  - `escalation_body`: radio chatter integration, "Does anyone copy?"
  - `discovery_opening`: hushed alerts, "You need to see this"
  - `loss_opening`: grim status reports, "They're gone" / "We lost sector seven"
  - `foreshadowing_body`: ominous observations, "Something isn't right" / eerie silence noted
  - `status_change_opening`: terse verbal updates via radio_chatter

### Tests (`tests/grammar_tests.rs`)
- Added "dialogue_line" to `social_drama_grammar_loads` expected rules
- Added "radio_chatter" to `survival_thriller_grammar_loads` expected rules
- All 106 tests pass, grammar linter clean, both examples produce dialogue output

## Entry 3

**Time:** 2026-02-22
**Prompt:** "Wire up existing Markov corpora — train inline, update examples, add {markov:...} slots to grammar rules"

**Work — Wire Up Markov Layer (COMPLETE):**

### Examples updated to train and load Markov models
- **`examples/dinner_party.rs`**: Added `MarkovTrainer` import, inline training of `genre_data/social_drama/corpus.txt` with trigrams (n=3), passed to builder via `.with_markov_models()` keyed as `"social_drama"`
- **`examples/jurassic_park.rs`**: Same pattern with `genre_data/survival_thriller/corpus.txt` keyed as `"survival_thriller"`

### Grammar rules updated with Markov-textured alternatives (weight: 1)
- **Social drama** (`genre_data/social_drama/grammar.ron`):
  - `revelation_body`: `{markov:social_drama:tense}` — tense texture for revelations
  - `confrontation_body`: `{markov:social_drama:tense}` — tense undercurrent
  - `alliance_body`: `{markov:social_drama:warm}` — warm texture for bonding
  - `comic_relief_body`: `{markov:social_drama:gossip}` — gossipy flavor
- **Survival thriller** (`genre_data/survival_thriller/grammar.ron`):
  - `escalation_body`: `{markov:survival_thriller:urgent}` — urgent texture
  - `foreshadowing_body`: `{markov:survival_thriller:dread}` — dread atmosphere
  - `loss_body`: `{markov:survival_thriller:dread}` — grim loss texture
  - `status_change_body`: `{markov:survival_thriller:technical}` — clinical report texture

### Verification
- All 106 tests pass
- Both examples run without error, no `[markov:...]` placeholders leak through
- Grammar linter passes clean on all genre data
